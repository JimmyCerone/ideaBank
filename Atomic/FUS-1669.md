#PriceEditing #Fusion #Amway

Add Changed By/Date to Sandbox Price Edit Table

Todos: 
 - [ ] Rendering issues (the cells appear out of order)
 - [ ] Blank case testing
	 - There needs to be handling for the case where the file hasn't been changed at all and nothing comes back from the query
	 - We should return an empty string...
	 - Would we change this in the #getPriceEditReportQuery?

#Error: 

- #Norwex-with-silver should run yarn build before it runs migrations. Right now, it doesn't, so I should have done that manually. Since I didn't, the compiled JS was out of date and expecting things that weren't in the updated norwex.

#Terminal:

- insert-mpv-dp-overlay-record --marketproductvariantid 00151829-a01c-45b1-9137-9ecede43c783 --sandboxid 3c106a0f-1f7a-43e5-b6e9-a8e235d0b899 --abopriceltax 50


**Blank Case Testing**
	- I think I need to tweak the query below: 
		```
		 CASE
           WHEN mpv."lastModifiedAt" > mir."lastModifiedAt" then mpv."lastModifiedAt"
	         ELSE mir."lastModifiedAt"
          END as "changedAt",
          CASE
           WHEN mpv."lastModifiedAt" > mir."lastModifiedAt" then mpv."lastModifiedBy"
	         ELSE mir."lastModifiedBy"
		      END as "changedBy" 
			  ```
			  
My guess is that I need to add a case where if there is neither a date for MPV nor MIR, then I I return an empty string. I'm not sure how to do that. I'm going to use tableplus to work that out.

Here's my attempt at an improved query: `SELECT
	CASE WHEN "MarketProductVariant"."lastModifiedBy" = "System" THEN
		CASE WHEN "MarketItemRevision"."lastModifiedBy" = "System" THEN
			''
		ELSE
		ELSE
			CASE WHEN "MarketProductVariant"."lastModifiedAt" > "MarketItemRevision"."lastModifiedAt" THEN
				"MarketProductVariant"."lastModifiedAt"
			ELSE
				"MarketItemRevision"."lastModifiedAt"
			END AS "changedAt",
			CASE WHEN "MarketProductVariant"."lastModifiedAt" > "MarketItemRevision"."lastModifiedAt" THEN
				"MarketProductVariant"."lastModifiedBy"
			ELSE
				"MarketItemRevision"."lastModifiedBy"
			END AS "changedBy"
		FROM
			"MarketProductVariant",
			"MarketItemRevision"; `